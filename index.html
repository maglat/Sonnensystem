<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonnensystem</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #020208; overflow: hidden; font-family: system-ui, sans-serif; color: white; }
        
        #loading { position: fixed; inset: 0; background: #020208; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 999; transition: opacity 0.8s; }
        #loading.done { opacity: 0; pointer-events: none; }
        
        .spin { width: 40px; height: 40px; border: 2px solid #223; border-top: 2px solid #00d4ff; border-radius: 50%; animation: rot 0.8s linear infinite; }
        @keyframes rot { to { transform: rotate(360deg); } }
        .loadtxt { margin-top: 15px; color: #445; letter-spacing: 2px; font-size: 0.8rem; }
        
        header { position: fixed; top: 0; left: 0; right: 0; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); z-index: 100; }
        h1 { font-size: 1.1rem; font-weight: 600; letter-spacing: 2px; color: #bbb; }
        
        .btns { display: flex; gap: 8px; }
        .btn { background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.12); color: #999; padding: 6px 12px; border-radius: 12px; font-size: 0.7rem; cursor: pointer; }
        .btn:hover { background: #00d4ff; color: #000; }
        
        .hint { position: fixed; bottom: 12px; right: 15px; color: #334; font-size: 0.6rem; text-align: right; z-index: 50; }
        
        .infobox { position: fixed; bottom: 20px; left: 20px; background: rgba(8, 12, 22, 0.94); border: 1px solid rgba(100, 150, 200, 0.15); border-radius: 16px; padding: 20px; width: 265px; z-index: 200; animation: slideUp 0.35s ease; }
        @keyframes slideUp{ from{transform:translateY(30px);opacity:0} to{transform:translateY(0);opacity:1} }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<div id="loading">
    <div class="spin"></div>
    <div class="loadtxt">INITIALISIERE...</div>
</div>

<header>
    <h1>Sonnensystem</h1>
    <div class="btns">
        <button class="btn" onclick="camReset()">üîÑ Reset</button>
        <button class="btn" onclick="toggleLbl()">üè∑ Labels</button>
        <button class="btn" onclick="toggleMoons()">üåô Monde</button>
        <button class="btn" onclick="toggleOrbits()">‚óØ Bahnen</button>
        <button class="btn" onclick="cycleSpd()">‚è© <span id="spdDisp">1x</span></button>
    </div>
</header>

<div class="hint">Ziehen:Rotieren ¬∑ Scroll:Zoomen ¬∑ Klick:Details</div>

<script>
var DB = {
    sun: {nm:'Sonne', sb:'Unser Stern', ds:'Zentrum des Sonnensystems.', df:'-', dg:'1.39 mio km', ob:'-', mn:'-', cl:0xffff00, emit:0xffaa00, rad:16},
    mercury: {nm:'Merkur', sb:'Klein & Schnell', ds:'Kleinster Planet.', df:'58 mio', dg:'4,879 km', ob:'88 T', mn:'0', cl:0xa0a0a0, inc:7.0},
    venus: {nm:'Venus', sb:'Gl√ºhend Heiss', ds:'Heissester Planet.', df:'108 mio', dg:'12,104 km', ob:'225 T', mn:'0', cl:0xe8c88a, inc:3.4},
    earth: {nm:'Erde', sb:'Blauer Planet', ds:'Unsere Heimat.', df:'150 mio', dg:'12,742 km', ob:'365 T', mn:'1', cl:0x2299ff, atm:0x66aaff, mns:[{r:0.4, d:4, s:12}]},
    mars: {nm:'Mars', sb:'Der Rote', ds:'Der rote Planet.', df:'228 mio', dg:'6,779 km', ob:'687 T', mn:'2', cl:0xdd4422, inc:1.85, mns:[{r:0.25, d:2.5, s:8}, {r:0.2, d:3.5, s:6}]},
    jupiter: {nm:'Jupiter', sb:'Der Riese', ds:'Gr√∂√üter Planet.', df:'778 mio', dg:'139,820 km', ob:'12 J', mn:'95', cl:0xddaa77, inc:1.3, mns:[{r:0.8, d:8, s:4}, {r:0.7, d:10, s:3}, {r:0.9, d:13, s:2}, {r:0.8, d:16, s:1.5}]},
    saturn: {nm:'Saturn', sb:'Mit Ring', ds:'Mit Ringsystem.', df:'1.4 mia', dg:'116,460 km', ob:'29 J', mn:'146', cl:0xeedd99, inc:2.5, rng:true, mns:[{r:0.6, d:9, s:5}, {r:0.4, d:12, s:3}]},
    uranus: {nm:'Uranus', sb:'Geneigt', ds:'Rotiert seitlich.', df:'2.9 mia', dg:'50,724 km', ob:'84 J', mn:'28', cl:0x77ccdd, inc:0.77, mns:[{r:0.4, d:7, s:3}]},
    neptune: {nm:'Neptun', sb:'Windy', ds:'Windigster Planet.', df:'4.5 mia', dg:'49,244 km', ob:'165 J', mn:'16', cl:0x4455cc, inc:1.77, mns:[{r:0.4, d:6, s:4}]}
};

var CFG = [
    {id:'mercury', r:1.8, d:40, s:4.2, t:0.03},
    {id:'venus', r:2.6, d:62, s:1.6, t:3.1},
    {id:'earth', r:2.8, d:86, s:1, t:0.41},
    {id:'mars', r:2, d:118, s:0.53, t:0.44},
    {id:'jupiter', r:7, d:175, s:0.085, t:0.05},
    {id:'saturn', r:6, d:228, s:0.035, t:0.47, rn:true},
    {id:'uranus', r:3.5, d:275, s:0.012, t:1.71},
    {id:'neptune', r:3.3, d:325, s:0.006, t:0.49}
];

var scene, camera, renderer, controls;
var pltObjs = [];
var orbitLines = [];
var lbls = [];
var shwLbl = true;
var showMoons = true;
var showOrbits = true;
var spdMul = 1;
var SPDS = [0.2, 0.5, 1, 2, 5];
var spdIdx = 2;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020208);
    scene.fog = new THREE.Fog(0x020208, 500, 3500);
    
    camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 6000);
    camera.position.set(0, 150, 300);
    
    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.4;
    document.body.insertBefore(renderer.domElement, document.body.firstChild);
    
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 30;
    controls.maxDistance = 2000;
    
    var sunLight = new THREE.DirectionalLight(0xfff8e8, 3.0);
    sunLight.position.set(0, 0, 0);
    scene.add(sunLight);
    
    var hemiLight = new THREE.HemisphereLight(0x8899bb, 0x222233, 0.8);
    scene.add(hemiLight);
    
    var ambLight = new THREE.AmbientLight(0x333344, 0.5);
    scene.add(ambLight);
    
    var ptLight = new THREE.PointLight(0xffffff, 2, 1000);
    ptLight.position.set(0, 0, 0);
    scene.add(ptLight);
    
    mkStars();
    mkSun();
    mkPlanets();
    
    window.addEventListener('resize', onResize);
    renderer.domElement.addEventListener('pointerdown', onClick);
    
    setTimeout(function(){ document.getElementById('loading').classList.add('done'); }, 600);
    
    animate();
}

function mkStars() {
    var positions = [];
    
    for(var i = 0; i < 5000; i++) {
        var r = 600 + Math.random() * 1500;
        var theta = Math.random() * Math.PI * 2;
        var phi = Math.acos(2 * Math.random() - 1);
        
        positions.push(
            r * Math.sin(phi) * Math.cos(theta),
            r * Math.sin(phi) * Math.sin(theta),
            r * Math.cos(phi)
        );
    }
    
    var geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    
    var mat = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1.5,
        sizeAttenuation: true,
        transparent: true,
        opacity: 1.0
    });
    
    scene.add(new THREE.Points(geo, mat));
}

function mkSun() {
    var dd = DB.sun;
    
    var geo = new THREE.SphereGeometry(dd.rad, 48, 48);
    var mat = new THREE.MeshStandardMaterial({
        color: dd.cl,
        emissive: dd.emit,
        emissiveIntensity: 2.5,
        roughness: 0.15,
        metalness: 0
    });
    var mesh = new THREE.Mesh(geo, mat);
    mesh.userData = {tp: 'sun', id: 'sun'};
    scene.add(mesh);
    
    [1.2, 1.6, 2.2].forEach(function(sc, i){
        var colors = [0xffdd44, 0xff8822, 0xff4400];
        var glow = new THREE.Mesh(
            new THREE.SphereGeometry(dd.rad * sc, 24, 24),
            new THREE.MeshBasicMaterial({
                color: colors[i],
                transparent: true,
                opacity: 0.2 - i * 0.05,
                side: THREE.BackSide
            })
        );
        mesh.add(glow);
    });
    
    pltObjs.push({mesh: mesh, cfg: {id: 'sun', r: dd.rad, s: 0, d: 0}});
}

function mkPlanets() {
    CFG.forEach(function(cf){
        var dd = DB[cf.id];
        var inc = dd.inc || 0;
        
        var orbitGroup = new THREE.Group();
        orbitGroup.rotation.x = inc * Math.PI / 180;
        scene.add(orbitGroup);
        
        var orbitPoints = [];
        for(var op = 0; op <= 96; op++) {
            var oAngle = (op / 96) * Math.PI * 2;
            orbitPoints.push(new THREE.Vector3(
                Math.cos(oAngle) * cf.d,
                0,
                Math.sin(oAngle) * cf.d
            ));
        }
        var orbitGeo = new THREE.BufferGeometry().setFromPoints(orbitPoints);
        var orbitMat = new THREE.LineBasicMaterial({ color: 0x335566, transparent: true, opacity: 0.35 });
        var orbitLine = new THREE.LineLoop(orbitGeo, orbitMat);
        orbitLine.visible = showOrbits;
        orbitGroup.add(orbitLine);
        orbitLines.push(orbitLine);
        
        var grp = new THREE.Group();
        grp.userData = {tp: 'plt', id: cf.id, ang: Math.random() * Math.PI * 2, spd: cf.s, dst: cf.d, orbitGroup: orbitGroup};
        
        var geo = new THREE.SphereGeometry(cf.r, 36, 36);
        var mat = new THREE.MeshStandardMaterial({
            color: dd.cl,
            roughness: dd.rs || 0.5,
            metalness: 0.15
        });
        
        var ms = new THREE.Mesh(geo, mat);
        ms.rotation.z = cf.t;
        ms.castShadow = true;
        ms.receiveShadow = true;
        ms.userData = {id: cf.id};
        grp.add(ms);
        
        if(dd.atm) {
            var at = new THREE.Mesh(
                new THREE.SphereGeometry(cf.r * 1.03, 24, 24),
                new THREE.MeshBasicMaterial({color: dd.atm, transparent: true, opacity: 0.2, side: THREE.BackSide})
            );
            ms.add(at);
        }
        
        if(cf.rn || dd.rng) {
            var rg = new THREE.Mesh(
                new THREE.RingGeometry(cf.r * 1.3, cf.r * 2.5, 56),
                new THREE.MeshBasicMaterial({color: 0xccbbaa, side: THREE.DoubleSide, transparent: true, opacity: 0.7})
            );
            rg.rotation.x = Math.PI / 2;
            ms.add(rg);
        }
        
        if(dd.mns && dd.mns.length > 0) {
            var moonGroup = new THREE.Group();
            ms.add(moonGroup);
            
            dd.mns.forEach(function(mn){
                var mGeo = new THREE.SphereGeometry(mn.r, 16, 16);
                var mMat = new THREE.MeshStandardMaterial({color: 0xbbbb99, roughness: 0.8, metalness: 0.1});
                var mMesh = new THREE.Mesh(mGeo, mMat);
                
                var mAng = Math.random() * Math.PI * 2;
                mMesh.userData = {tp: 'moon', pid: cf.id, ang: mAng, spd: mn.s, dst: mn.d};
                mMesh.visible = showMoons;
                mMesh.position.set(Math.cos(mAng) * mn.d, 0, Math.sin(mAng) * mn.d);
                moonGroup.add(mMesh);
            });
        }
        
        var cnvs = document.createElement('canvas');
        cnvs.width = 256;
        cnvs.height = 56;
        var ctx = cnvs.getContext('2d');
        ctx.font = 'bold 22px system-ui';
        ctx.textAlign = 'center';
        ctx.fillStyle = '#fff';
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 3;
        ctx.strokeText(dd.nm, 128, 36);
        ctx.fillText(dd.nm, 128, 36);
        
        var lb = new THREE.Sprite(new THREE.SpriteMaterial({map: new THREE.CanvasTexture(cnvs), transparent: true, depthTest: false}));
        lb.scale.set(20, 4.5, 1);
        lb.position.set(0, cf.r + 5, 0);
        lb.visible = shwLbl;
        grp.add(lb);
        lbls.push(lb);
        
        var ag = grp.userData.ang;
        grp.position.set(Math.cos(ag) * cf.d, 0, Math.sin(ag) * cf.d);
        
        orbitGroup.add(grp);
        pltObjs.push({mesh: grp, inner: ms, cfg: cf, isPlanet: true});
    });
}

function onClick(e) {
    var mx = (e.clientX / window.innerWidth) * 2 - 1;
    var my = -(e.clientY / window.innerHeight) * 2 + 1;
    
    var rc = new THREE.Raycaster();
    rc.setFromCamera({x: mx, y: my}, camera);
    
    var clickables = [];
    pltObjs.forEach(function(p){
        if(p.inner) clickables.push(p.inner);
        if(p.mesh) clickables.push(p.mesh);
    });
    
    var hs = rc.intersectObjects(clickables, true);
    
    if(hs.length) {
        var obj = hs[0].object;
        while(obj && !obj.userData.id) obj = obj.parent;
        if(obj && obj.userData.id) shwInf(obj.userData.id);
    }
}

var currInfoId = null;

function shwInf(id) {
    if(currInfoId === id) return;
    currInfoId = id;
    
    var d = DB[id];
    var old = document.querySelector('.infobox');
    if(old) old.remove();
    
    var div = document.createElement('div');
    div.className = 'infobox';
    div.innerHTML = '<button onclick="this.parentElement.remove();currInfoId=null" style="position:absolute;top:8px;right:10px;width:24px;height:24px;border:none;background:rgba(255,255,255,0.1);color:#889;border-radius:50%;cursor:pointer;font-size:1rem;">√ó</button>' +
        '<h2 style="font-size:1.3rem;color:#00d4ff;margin:0 0 2px;">'+d.nm+'</h2>' +
        '<div style="font-size:0.6rem;color:#557;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">'+d.sb+'</div>' +
        '<p style="font-size:0.8rem;color:#99a;line-height:1.5;margin:0;">'+d.ds+'</p>' +
        '<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:14px;">' +
        '<div style="background:rgba(255,255,255,0.04);padding:8px;border-radius:8px;"><div style="font-size:0.55rem;color:#567;text-transform:uppercase;">Entfernung</div><div style="font-size:0.8rem;">'+d.df+'</div></div>' +
        '<div style="background:rgba(255,255,255,0.04);padding:8px;border-radius:8px;"><div style="font-size:0.55rem;color:#567;text-transform:uppercase;">√ò</div><div style="font-size:0.8rem;">'+d.dg+'</div></div>' +
        '<div style="background:rgba(255,255,255,0.04);padding:8px;border-radius:8px;"><div style="font-size:0.55rem;color:#567;text-transform:uppercase;">Umlauf</div><div style="font-size:0.8rem;">'+d.ob+'</div></div>' +
        '<div style="background:rgba(255,255,255,0.04);padding:8px;border-radius:8px;"><div style="font-size:0.55rem;color:#567;text-transform:uppercase;">Monde</div><div style="font-size:0.8rem;">'+d.mn+'</div></div>' +
        '</div>' +
        (d.inc !== undefined ? '<div style="margin-top:10px;font-size:0.65rem;color:#556;">Inklation: '+d.inc+'¬∞</div>' : '');
    document.body.appendChild(div);
}

window.camReset = function() { 
    camera.position.set(0, 150, 300); 
    controls.target.set(0, 0, 0); 
};

window.toggleLbl = function() { 
    shwLbl = !shwLbl; 
    lbls.forEach(function(l){ l.visible = shwLbl; }); 
};

window.toggleMoons = function() {
    showMoons = !showMoons;
    pltObjs.forEach(function(p){
        if(p.isPlanet && p.inner) {
            p.inner.children.forEach(function(ch){
                if(ch.isGroup) ch.children.forEach(function(m){ m.visible = showMoons; });
            });
        }
    });
};

window.toggleOrbits = function() {
    showOrbits = !showOrbits;
    orbitLines.forEach(function(line){
        line.visible = showOrbits;
    });
};

window.cycleSpd = function() {
    spdIdx = (spdIdx + 1) % SPDS.length;
    spdMul = SPDS[spdIdx];
    document.getElementById('spdDisp').textContent = spdMul + 'x';
};

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

var lastT = 0;
function animate(t) {
    requestAnimationFrame(animate);
    var dt = (t - lastT) / 1000 || 0.016;
    lastT = t;
    if(dt > 0.1) return;
    
    pltObjs.forEach(function(p){
        if(p.cfg.s === 0) return;
        
        var u = p.mesh.userData;
        u.ang += dt * p.cfg.s * 0.35 * spdMul;
        
        p.mesh.position.set(Math.cos(u.ang) * u.dst, 0, Math.sin(u.ang) * u.dst);
        
        if(p.inner) p.inner.rotation.y += dt * 1.5 * spdMul;
        
        if(p.inner) {
            p.inner.children.forEach(function(child){
                if(child.isGroup) {
                    child.children.forEach(function(moon){
                        if(moon.userData.tp === 'moon') {
                            moon.userData.ang += dt * moon.userData.spd * 2 * spdMul;
                            var ma = moon.userData.ang;
                            var md = moon.userData.dst;
                            moon.position.set(Math.cos(ma) * md, 0, Math.sin(ma) * md);
                        }
                    });
                }
            });
        }
    });
    
    controls.update();
    renderer.render(scene, camera);
}

init();
</script>
</body>
</html>